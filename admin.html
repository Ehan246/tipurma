<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ItemSalesBD | Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
    background:#000;
    color:#00ff88;
    font-family:Arial;
    padding:20px;
}
input,button {
    padding:8px;
    margin:5px 0;
}
</style>
</head>

<body>

<h1>Admin Panel</h1>

<div id="login">
    <input id="email" placeholder="Email"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
</div>

<div id="admin" style="display:none">
    <h2>Add Product</h2>
    <input id="pname" placeholder="Name"><br>
    <input id="pprice" placeholder="Price"><br>
    <button onclick="addProduct()">Add</button>

    <h2>Orders</h2>
    <div id="orders"></div>
</div>

<script>
/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDTyjzVYkwyeayKjZjfFNWHpLZJB5XOo1A",
  authDomain: "itemsalesbd.firebaseapp.com",
  databaseURL: "https://itemsalesbd-default-rtdb.firebaseio.com",
  projectId: "itemsalesbd",
  storageBucket: "itemsalesbd.firebasestorage.app",
  messagingSenderId: "390468845332",
  appId: "1:390468845332:web:7350cfdf25f23151688c01"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

/* Login */
function login() {
    auth.signInWithEmailAndPassword(
        email.value,
        password.value
    );
}

/* Auth */
auth.onAuthStateChanged(async user => {
    if (!user) return;

    const roleSnap = await db.ref('users/' + user.uid + '/role').once('value');
    if (roleSnap.val() !== 'admin') {
        alert('Not admin');
        auth.signOut();
        return;
    }

    document.getElementById('login').style.display = 'none';
    document.getElementById('admin').style.display = 'block';
    loadOrders();
});

/* Add product */
function addProduct() {
    db.ref('products').push({
        name: pname.value,
        price: Number(pprice.value),
        createdAt: Date.now()
    });
    alert('Product added');
}

/* Load orders */
function loadOrders() {
    const box = document.getElementById('orders');
    db.ref('orders').on('value', snap => {
        let html = '';
        snap.forEach(o => {
            const d = o.val();
            html += `<div>${d.productName} - $${d.price}</div>`;
        });
        box.innerHTML = html;
    });
}
</script>

</body>
</html>
