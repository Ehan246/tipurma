<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - ItemSalesBD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body{font-family:Arial;background:#f1f3f6;margin:0}
    header{background:#111;color:white;padding:15px;text-align:center}
    .container{padding:20px}
    .card{background:white;padding:15px;margin:10px 0;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.1)}
    input,textarea{padding:10px;margin:5px 0;width:100%;border-radius:5px;border:1px solid #ccc}
    button{padding:8px 15px;background:#111;color:white;border:none;border-radius:5px;cursor:pointer;margin:5px 0}
    .danger{background:red}
    .success{background:green}
  </style>
</head>
<body>

<header>
  <h2>Admin Panel</h2>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

  <div id="loginBox">
    <h3>Admin Login</h3>
    <input type="email" id="adminEmail" placeholder="Admin Email">
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div id="adminPanel" style="display:none;">

    <div class="card">
      <h3>Website Settings</h3>
      <input type="text" id="siteTitleInput" placeholder="Website Title">
      <button onclick="updateTitle()">Update Title</button>
    </div>

    <div class="card">
      <h3>Add Product</h3>
      <input type="text" id="pName" placeholder="Product Name (Required)">
      <input type="number" id="pPrice" placeholder="Price (Required)">
      <input type="number" id="pStock" placeholder="Stock (Required)">
      <input type="text" id="pImage" placeholder="Image URL (Required)">
      <textarea id="pDesc" placeholder="Description (Optional)"></textarea>
      <input type="number" id="pSub" placeholder="Subscription Days (Optional)">
      <button onclick="addProduct()">Add Product</button>
    </div>

    <div class="card">
      <h3>All Products</h3>
      <div id="allProducts"></div>
    </div>

    <div class="card">
      <h3>All Orders</h3>
      <div id="allOrders"></div>
    </div>

  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDTyjzVYkwyeayKjZjfFNWHpLZJB5XOo1A",
  authDomain: "itemsalesbd.firebaseapp.com",
  projectId: "itemsalesbd",
  storageBucket: "itemsalesbd.firebasestorage.app",
  messagingSenderId: "390468845332",
  appId: "1:390468845332:web:7350cfdf25f23151688c01"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.login = async function(){
  await signInWithEmailAndPassword(auth,adminEmail.value,adminPass.value);
}

window.logout = async function(){
  await signOut(auth);
}

onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.style.display="none";
    adminPanel.style.display="block";
    loadProducts();
    loadOrders();
  }else{
    loginBox.style.display="block";
    adminPanel.style.display="none";
  }
});

window.addProduct = async function(){
  if(!pName.value || !pPrice.value || !pStock.value || !pImage.value){
    alert("Required fields missing!");
    return;
  }

  await addDoc(collection(db,"products"),{
    name:pName.value,
    price:Number(pPrice.value),
    stock:Number(pStock.value),
    image:pImage.value,
    description:pDesc.value || "",
    subscriptionDays:Number(pSub.value) || 0,
    created:new Date()
  });

  alert("Product Added!");
}

function loadProducts(){
  onSnapshot(collection(db,"products"),snapshot=>{
    allProducts.innerHTML="";
    snapshot.forEach(docSnap=>{
      let p=docSnap.data();
      allProducts.innerHTML+=`
        <div class="card">
          <b>${p.name}</b>
          <p>Price: ${p.price}৳</p>
          <p>Stock: ${p.stock}</p>
          <button onclick="deleteProduct('${docSnap.id}')" class="danger">Delete</button>
        </div>
      `;
    });
  });
}

window.deleteProduct = async function(id){
  await deleteDoc(doc(db,"products",id));
}

function loadOrders(){
  onSnapshot(collection(db,"orders"),snapshot=>{
    allOrders.innerHTML="";
    snapshot.forEach(docSnap=>{
      let o=docSnap.data();
      allOrders.innerHTML+=`
        <div class="card">
          <p>User ID: ${o.userId}</p>
          <p>Price: ${o.price}৳</p>
          <p>Status: ${o.status}</p>
          <button onclick="completeOrder('${docSnap.id}')" class="success">Mark Complete</button>
        </div>
      `;
    });
  });
}

window.completeOrder = async function(id){
  await updateDoc(doc(db,"orders",id),{
    status:"Completed"
  });
}
</script>

</body>
</html>
