<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ItemSalesBD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    background:#0a0a0a;
    color:#00ff88;
    font-family:Arial;
    padding:30px;
}
input,button{
    padding:8px;
    margin:6px 0;
}
</style>
</head>
<body>

<h1>ItemSalesBD Login System</h1>

<input id="email" placeholder="Email"><br>
<input id="password" type="password" placeholder="Password"><br>

<button id="signupBtn">Signup</button>
<button id="loginBtn">Login</button>
<button id="logoutBtn">Logout</button>

<h3 id="status"></h3>

<script type="module">

// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, set } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDTyjzVYkwyeayKjZjfFNWHpLZJB5XOo1A",
  authDomain: "itemsalesbd.firebaseapp.com",
  databaseURL: "https://itemsalesbd-default-rtdb.firebaseio.com",
  projectId: "itemsalesbd",
  storageBucket: "itemsalesbd.firebasestorage.app",
  messagingSenderId: "390468845332",
  appId: "1:390468845332:web:7350cfdf25f23151688c01",
  measurementId: "G-1REJXDEMSD"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// Elements
const email = document.getElementById("email");
const password = document.getElementById("password");
const statusText = document.getElementById("status");

// Signup
document.getElementById("signupBtn").onclick = async () => {
    try {
        const userCred = await createUserWithEmailAndPassword(
            auth,
            email.value,
            password.value
        );

        // Save user role as customer
        await set(ref(db, 'users/' + userCred.user.uid), {
            email: email.value,
            role: "customer",
            createdAt: Date.now()
        });

        alert("Account created!");
    } catch (err) {
        alert(err.message);
    }
};

// Login
document.getElementById("loginBtn").onclick = async () => {
    try {
        await signInWithEmailAndPassword(auth, email.value, password.value);
        alert("Logged in!");
    } catch (err) {
        alert(err.message);
    }
};

// Logout
document.getElementById("logoutBtn").onclick = () => {
    signOut(auth);
};

// Auth state
onAuthStateChanged(auth, (user) => {
    if (user) {
        statusText.innerText = "Logged in as: " + user.email;
    } else {
        statusText.innerText = "Not logged in";
    }
});

</script>

</body>
</html>
